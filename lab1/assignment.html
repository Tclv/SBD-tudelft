<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Assignment - Supercomputing for Big Data - Lab Manual</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
                <link rel="stylesheet" href="../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction/index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../introduction/goal-of-this-lab.html"><strong aria-hidden="true">1.1.</strong> Goal of this lab</a></li><li class="chapter-item expanded "><a href="../introduction/code-repositories.html"><strong aria-hidden="true">1.2.</strong> Code repositories</a></li><li class="chapter-item expanded "><a href="../introduction/groups.html"><strong aria-hidden="true">1.3.</strong> Groups</a></li><li class="chapter-item expanded "><a href="../introduction/aws.html"><strong aria-hidden="true">1.4.</strong> AWS</a></li><li class="chapter-item expanded "><a href="../introduction/grading.html"><strong aria-hidden="true">1.5.</strong> Grading</a></li></ol></li><li class="chapter-item expanded "><a href="../getting-started/index.html"><strong aria-hidden="true">2.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-started/docker.html"><strong aria-hidden="true">2.1.</strong> Docker</a></li><li class="chapter-item expanded "><a href="../getting-started/scala.html"><strong aria-hidden="true">2.2.</strong> Scala</a></li><li class="chapter-item expanded "><a href="../getting-started/apache-spark/index.html"><strong aria-hidden="true">2.3.</strong> Apache Spark</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-started/apache-spark/resilient-distributed-datasets.html"><strong aria-hidden="true">2.3.1.</strong> Resilient Distributed Datasets</a></li><li class="chapter-item expanded "><a href="../getting-started/apache-spark/dataframe-and-dataset.html"><strong aria-hidden="true">2.3.2.</strong> Dataframe and Dataset</a></li><li class="chapter-item expanded "><a href="../getting-started/apache-spark/packaging-your-application-using-sbt.html"><strong aria-hidden="true">2.3.3.</strong> Packaging your application using SBT</a></li></ol></li><li class="chapter-item expanded "><a href="../getting-started/amazon-web-services.html"><strong aria-hidden="true">2.4.</strong> Amazon Web Services</a></li><li class="chapter-item expanded "><a href="../getting-started/apache-kafka.html"><strong aria-hidden="true">2.5.</strong> Apache Kafka</a></li><li class="chapter-item expanded "><a href="../getting-started/openstreetmap.html"><strong aria-hidden="true">2.6.</strong> OpenStreetMap</a></li><li class="chapter-item expanded "><a href="../getting-started/alos.html"><strong aria-hidden="true">2.7.</strong> ALOS Global Digital Surface Model</a></li></ol></li><li class="chapter-item expanded "><a href="../lab1/index.html"><strong aria-hidden="true">3.</strong> Lab 1</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lab1/before-you-start.html"><strong aria-hidden="true">3.1.</strong> Before you start</a></li><li class="chapter-item expanded "><a href="../lab1/assignment.html" class="active"><strong aria-hidden="true">3.2.</strong> Assignment</a></li><li class="chapter-item expanded "><a href="../lab1/deliverables.html"><strong aria-hidden="true">3.3.</strong> Deliverables</a></li><li class="chapter-item expanded "><a href="../lab1/rubric.html"><strong aria-hidden="true">3.4.</strong> Rubric</a></li></ol></li><li class="chapter-item expanded "><a href="../lab2/index.html"><strong aria-hidden="true">4.</strong> Lab 2</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lab2/before-you-start.html"><strong aria-hidden="true">4.1.</strong> Before you start</a></li><li class="chapter-item expanded "><a href="../lab2/assignment.html"><strong aria-hidden="true">4.2.</strong> Assignment</a></li><li class="chapter-item expanded "><a href="../lab2/deliverables.html"><strong aria-hidden="true">4.3.</strong> Deliverables</a></li><li class="chapter-item expanded "><a href="../lab2/rubric.html"><strong aria-hidden="true">4.4.</strong> Rubric</a></li></ol></li><li class="chapter-item expanded "><a href="../lab3/index.html"><strong aria-hidden="true">5.</strong> Lab 3</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lab3/before-you-start.html"><strong aria-hidden="true">5.1.</strong> Before you start</a></li><li class="chapter-item expanded "><a href="../lab3/assignment.html"><strong aria-hidden="true">5.2.</strong> Assignment</a></li><li class="chapter-item expanded "><a href="../lab3/deliverables.html"><strong aria-hidden="true">5.3.</strong> Deliverables</a></li><li class="chapter-item expanded "><a href="../lab3/rubric.html"><strong aria-hidden="true">5.4.</strong> Rubric</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../faq.html"><strong aria-hidden="true">6.</strong> FAQ</a></li><li class="chapter-item expanded "><a href="../quiz_example.html"><strong aria-hidden="true">7.</strong> Quiz example</a></li><li class="chapter-item expanded "><a href="../links.html"><strong aria-hidden="true">8.</strong> Useful links</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Supercomputing for Big Data - Lab Manual</h1>

                    <div class="right-buttons">
                                                <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="assignment"><a class="header" href="#assignment">Assignment</a></h2>
<p>The requirements of the application that you must implement are described below
in three tiers (&quot;adequate&quot;, &quot;good&quot; and &quot;excellent&quot;). These tiers correspond to
one of the grading criteria (explained on the next page). To pass the lab, you
must at least achieve the &quot;adequate&quot; tier. &quot;Good&quot; and &quot;excellent&quot; tier
applications contain <strong>additional</strong> requirements (and may supersede previous
requirements where applicable) that the program needs to adhere to.</p>
<p>The goal of this lab is to make an application which efficiently determines how many people would need to relocate at different amount of sea level rise. </p>
<h3 id="adequate-application-requirements"><a class="header" href="#adequate-application-requirements">&quot;Adequate&quot; application requirements</a></h3>
<ol>
<li>The application takes an integer amount of sea level rise in meters from the command line as the first positional argument.</li>
<li>The application uses the ALOS Global Digital Surface Model dataset to determine which places are exactly at or below the new sea level, you can disregard any man-made or natural water barriers. So if the sea level rises 0 meters, everybody living in a place at elevation of 0 meters or lower has to relocate.</li>
<li>The application uses the OpenStreetMap dataset to determine populations. Only cities, towns, villages and hamlets are used to determine if the population needs to relocate. Boroughs, suburbs, quarters etc. are parts of cities and should not be considered separately. The whole population of a city/town/village/hamlet can be assumed to live at the exact coordinates of the place in the OSM dataset.</li>
<li>When determining which place lies at which elevation, the application uses the <a href="https://github.com/uber/h3">H3: Uber’s Hexagonal Hierarchical Spatial Index</a>
to reduce the computational complexity of joins between the OSM and ALOS data sets. In the report (README.md), it is explicitly explained why using such a spatial index reduces the computational complexity for these types of joins.</li>
<li>The application uses the average elevation of an H3 tile to determine if a population needs to relocate.</li>
<li>The application uses an H3 resolution of 9.</li>
<li>The application outputs the sum of all evacuees on the command line.</li>
<li>The application outputs an <code>.orc</code> file with the following schema, where <code>place</code> is the name of a city/town/village/hamlet, and <code>num_evacuees</code> is the number of people in this place:</li>
</ol>
<pre><code class="language-scala">import org.apache.spark.sql.types._

val schema = StructType(
               Array(
                 StructField(&quot;place&quot;, StringType),
                 StructField(&quot;num_evacuees&quot;, LongType)
               )
             )
</code></pre>
<h3 id="good-application-requirements"><a class="header" href="#good-application-requirements">&quot;Good&quot; application requirements</a></h3>
<ol start="9">
<li>Produce a relocation plan which is a mapping from source place to the
closest safe (one that is not underwater) city (not town or village or
hamlet). For the distance calculation, consider the earth to be flat (like
🥞), i.e. you don't have to take the curvature of the earth into
consideration. In this case, the application outputs a modified <code>.orc</code> file
with the following schema, where <code>place</code> is the name of a
city/town/village/hamlet, <code>num_evacuees</code> is the number of people in this
place, and <code>destination</code> is the name of the city to relocate to.</li>
</ol>
<pre><code class="language-scala">import org.apache.spark.sql.types._

val schema = StructType(
               Array(
                 StructField(&quot;place&quot;, StringType),
                 StructField(&quot;num_evacuees&quot;, LongType)
                 StructField(&quot;destination&quot;, StringType)
               )
             )
</code></pre>
<h3 id="excellent-application-requirements"><a class="header" href="#excellent-application-requirements">&quot;Excellent&quot; application requirements</a></h3>
<ol start="10">
<li>The application also calculates the distance of each place to the closest
harbour.</li>
<li>If a harbour is closer than a safe city, 25% of the population of the place
must relocate to the harbour to get a boat and live on the ocean. The other 
75% will still relocate to the nearest safe city. The application outputs a 
modified <code>.orc</code> file with the following schema, where <code>place</code> is the name of 
a city/town/village/hamlet, <code>num_evacuees</code> is the number of people 
evacuating to the <code>destination</code>, which is the name of the city to relocate
to or <code>Waterworld</code> in the case of boat relocation:</li>
</ol>
<pre><code class="language-scala">import org.apache.spark.sql.types._

val schema = StructType(
               Array(
                 StructField(&quot;place&quot;, StringType),
                 StructField(&quot;num_evacuees&quot;, LongType)
                 StructField(&quot;destination&quot;, StringType)
               )
             )
</code></pre>
<ol start="12">
<li>The application produces a list of cities that are to be relocated to,
including <code>Waterworld</code> as if it's a city. The list also provides the old
population and the new population The application outputs this list as a
secondary <code>.orc</code> file with the following schema, where <code>destination</code> is the
name of the city (or <code>Waterworld</code>) that will receive evacuees,
<code>old_population</code> is the population before relocation, and <code>new_population</code>
is the population after relocation.</li>
</ol>
<pre><code class="language-scala">import org.apache.spark.sql.types._

val schema = StructType(
               Array(
                 StructField(&quot;destination&quot;, StringType),
                 StructField(&quot;old_population&quot;, LongType)
                 StructField(&quot;new_population&quot;, LongType)
               )
             )
</code></pre>
<h3 id="input"><a class="header" href="#input">Input</a></h3>
<p>For this lab, we will limit ourselves to answer the above questions for
the <a href="http://download.geofabrik.de/europe/netherlands-latest.osm.pbf">Netherlands</a> subset of OpenStreetMap (provided by <a href="https://geofabrik.de/">Geofabrik</a>) and ALOS.
The <code>.osm.pbf</code> files can be converted to ORC files using the tool mentioned in
the introduction. The ALOS tool mentioned in the introduction can be used to
obtain Parquet files with elevation data.</p>
<p><strong>For the sea level rise, you should report your output for <code>0</code>, <code>10</code>, and <code>100</code>
meters,</strong> but feel free to experiment with other levels.</p>
<h3 id="hints"><a class="header" href="#hints">Hints</a></h3>
<p>Try to keep the following in mind when building your application:</p>
<ul>
<li>Functionality: providing a correct answer to this query is not trivial,
attempt to make your application as robust as possible.</li>
<li>Scalable: your application should keep functioning correctly when the size of
the input data set grows larger.</li>
<li>Use H3 version 3.7.0, since higher versions may cause problems in the
container setup.</li>
<li>If you use all data while developing and debugging, testing a single code
change may take very long, e.g. more than 10 minutes. Therefore, while
developing, try to make your iterations as short as possible by limiting the
input datasets. For example, you could first try to answer the question only
for cities of a population higher than some large amount (so you end up
answering the query for a few cities, rather than for thousands of places).
Or, you could load only one or two ALOS tiles of which you know includes a few
places, so you end up with less elevation data. Once you have a functional
implementation, move towards calculating on the whole dataset to report the
output and the run times.</li>
<li>To get an idea of where a lot of computation takes place, make sure to check
the Spark history server. This helps you think about how to improve expensive
steps such as shuffles, by reordering or caching computations, or
pre-processing data sets, or by thinking about when to include pieces of data
in intermediate dataframes/sets.</li>
<li>When writing ORC files, multiple files will be created. This is fine, because
Spark saves each partition separately and for a typical deployment it does so 
in a distributed manner. When a requirement says to write &quot;an ORC file&quot;, it is
OK if you end up with multiple files.</li>
<li>For 0 meter sealevel rise, a whole lot of people should move. This is obviously not very realistic. If you want to see if you can get a more realistic answer, you can do so and put it in the report, might be worth some bonus points. But make sure you also show that you did the exercise as written.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../lab1/before-you-start.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../lab1/deliverables.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../lab1/before-you-start.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../lab1/deliverables.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
